name: iOS starter workflow

on:
  push:
    branches: [ "sprint" ]
#  pull_request:
#    branches: [ "sprint" ]

jobs:
  BUILD:
    name: Build iOS apk
    runs-on: macos-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3
        
      - name: Build iOS
        run: |
          npm install -legacy-peer-deps
          cd ios
          pod install
          npx react-native run-ios
          ls -al

  JEST:
    name: Run JEST Tests
    runs-on: ubuntu-latest
    needs: [BUILD]
    steps:
    - uses: actions/checkout@v3
    - name: Run Jest Tests
      run: | 
        npm install --force
  #      npm run test:unit
  
  EAS:
    name: Run EAS CLI
    runs-on: ubuntu-latest
    needs: [BUILD, JEST]
    steps:
    - uses: actions/checkout@v3
    - name: Install EAS CLI
      run: npm install -g eas-cli
#   - name: Set environment variables
#     working-directory: app
#     run: |
#      rm eas.json
#      cat eas.json.tmpl | envsubst > eas.json
#        cat eas.json
    - name: Build Expo app binary for iOS
      working-directory: app
      run: |
        ls
        pwd
        eas build --non-interactive --platform=ios --profile preview
      
  # FASTLANE:
  # name: Publish iOS Build through Fastlane
  #  runs-on: ubuntu-latest
  # needs: [BUILD, JEST]
  # steps:
  #  - uses: actions/checkout@v3
        
  # - name: Fastlane
  #   run: | 
  #    sudo gem install fastlane
  #    cd fastlane
  #   fastlane ios beta
